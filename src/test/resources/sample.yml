pipeline:

  input:
    mysql-masters:
      - connection:
          address: 192.168.1.100
          port: 1234
          user: root
          password-file: password
        schema:
          name: "*"
          tables:
            - name: affair
              row-name: [id, name] # default id is not null, other can be null
            - name: file
              row-name: [id, name, uploader]
            - name: folder
              row-name: [id, name, uploader]

      - connection:
          address: 192.168.1.100
          port: 1235
          user: root
          password-file: password
        schema:
          name: "*"
          tables:
            - name: affair
              row-name: [id, name]
            - name: file
              row-name: [id, name, uploader]
            - name: folder
              row-name: [id, name, uploader]

# input result class: com.github.zzt93.syncer.common.SyncData
#{
#  schema: xxx
#  table: xxx
#  id: xid
#  row: {
#    id: xid
#    ...
#  }
#  extra: {
#    ...
#  }
#}

  filter:
    - condition: "#{table}"
      switcher:
        "file": ["#{addExtra('suffix', row['xxx'])}","#{addExtra('type', 'INDEX_FILE'}", "#{addRow('type', 'FILE'}" ]
        "folder": ["#{addExtra('suffix', row['xxx'])}","#{addExtra('type', 'INDEX_FILE'}", "#{addRow('type', 'DIR'}"]
        "affair": ["#{addExtra('suffix', row['xxx'])}","#{addExtra('type', 'INDEX_AFFAIR'}"]


# filter result class: com.github.zzt93.syncer.common.SyncData
#{
#  schema: xxx
#  table: xxx
#  id: xid
#  row: {
#    id: xid
#    ...
#  }
#  extra: {
#    ...
#  }
#}


  output:

    http:
      connection:
        address: 192.168.1.100
        port: 9700
      json-mapper:
        "data":
          "parentId": "#{row['parent_id']}"
          "superId": "#{row['superid']}"
          "allianceId": "#{row['alliance_id']}"
          "row.*": "row.*"
        "type": "#{extra['type']}"

